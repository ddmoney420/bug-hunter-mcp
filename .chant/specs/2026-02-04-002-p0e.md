---
type: code
status: in_progress
target_files:
- src/index.ts
---
# Add Comprehensive Input Validation to MCP Tools

## Problem Statement

Bug Hunter MCP exposes 9 tools to Claude Code via the Model Context Protocol. Currently, there is limited validation of user-provided input parameters. This creates several risks:

1. **Runtime Crashes**: Invalid inputs can cause unhandled exceptions
2. **Security Issues**: No sanitization of repo URLs or file paths
3. **Confusing Errors**: Users get raw JavaScript errors instead of helpful guidance
4. **API Abuse**: No rate limiting on GitHub API calls
5. **Resource Leaks**: Uncontrolled repository clones can consume disk space

For example:
- `analyze_repo` with `repo: "invalid"` (missing owner/repo format) causes crash
- `claim_issue` with negative issue numbers bypasses validation
- `scaffold_solution` without bounds checking can clone very large repos
- `hunt_issues` with `limit: 1000` can cause excessive API calls

This is a **P0 enhancement** because validation is critical for:
- Reliability of the MCP server
- User experience when parameters are wrong
- Security posture when handling external input
- Foundation for future features

## Solution Approach

### Phase 1: Input Validation Framework
Create a reusable validation module that:
- Validates parameter types and ranges
- Provides consistent error messages to users
- Rejects clearly invalid inputs early

### Phase 2: Tool-Specific Validators
Add validators for each of 9 tools:
- `hunt_issues`: Validate language, limit (1-30), min_stars (0+)
- `analyze_repo`: Validate repo format (owner/repo), issue_number (1+)
- `scaffold_solution`: Validate repo format, issue_number (1+)
- `claim_issue`: Validate repo format, issue_number (1+)
- `generate_chant_spec`: Validate repo format, issue_number (1+)
- `chant_init`: Validate repo format
- `chant_list`: Validate repo format, status/type/label from allowed set
- `chant_show`: Validate repo format, spec_id format
- `research_workflow`: Validate repo format, issue_number (1+)

### Phase 3: Error Handling
Provide user-friendly error responses that:
- Explain what went wrong
- Suggest how to fix it
- Include usage examples for ambiguous cases

## Acceptance Criteria

- [ ] Create `src/validators.ts` with reusable validation functions
- [ ] Add input validation to all 9 MCP tools
- [ ] Implement type checking for all parameters
- [ ] Add range validation (e.g., limit 1-30, issue_number > 0)
- [ ] Add format validation (e.g., repo must be "owner/repo")
- [ ] Validate enum values (e.g., status: pending|ready|completed)
- [ ] Return helpful error messages when validation fails
- [ ] All tests pass with `npm test`
- [ ] No TypeScript errors with `npm run build`

## Target Files

- `src/index.ts` - Add validation calls to all tools
- `src/validators.ts` - New file with validation functions (to be created)

## Edge Cases to Handle

- Empty strings for optional parameters
- Negative numbers for numeric parameters
- Whitespace-only strings
- Repositories with 100k+ files (disk space concern)
- Very long parameter values that could cause memory issues
- Special characters in repo names that break shell commands

## Example Test Cases

For `analyze_repo`:
- Valid: `repo: "zigtools/zls"` → Proceeds
- Invalid: `repo: "invalid"` → Error: "Repo must be in format owner/repo"
- Invalid: `repo: ""` → Error: "Repo cannot be empty"
- Invalid: `issue_number: -1` → Error: "Issue number must be positive"

For `hunt_issues`:
- Valid: `limit: 10, min_stars: 100` → Proceeds
- Invalid: `limit: 1000` → Error: "Limit must be 1-30, got 1000"
- Invalid: `min_stars: -100` → Error: "min_stars must be non-negative"

## Success Criteria

1. ✅ User provides invalid input → Server returns helpful error, doesn't crash
2. ✅ All 9 tools validate their inputs before executing
3. ✅ TypeScript builds without errors
4. ✅ Tests pass (if any test input validation)