---
type: code
status: in_progress
target_files:
  - src/lessons.ts
  - src/validators.ts
  - src/profile.ts
  - src/index.ts
model: claude-haiku-4-5-20251001
---
# P0: Enhanced Quiz Validation & Concept Retention Metrics

## Problem Statement

The current Quiz system in LESSONS.md lacks:
1. **Quiz Validation**: No mechanism to validate quiz questions are well-formed (exactly 4 options, 1 correct answer, proper structure)
2. **Quiz Answer Checking**: No tool to validate user quiz answers against the answer key
3. **Concept Retention Metrics**: No tracking of quiz attempts, pass rates, or concept mastery trends over time
4. **Retention Analytics**: No way to identify weak concepts that need review

This P0 feature is essential for the learning workflow: bugs → lessons → quizzes → concept mastery tracking.

## Solution Approach

### 1. Enhanced Quiz Validation (lessons.ts)
- Create `validateQuiz()` function to check quiz structure:
  - Each quiz has 1-5 questions
  - Each question has exactly 4 options
  - Exactly one option is marked as correct (`isCorrect: true`)
  - All questions and options are non-empty strings
  - Question text is <= 500 chars, option text is <= 200 chars
  - Return validation results with specific errors

### 2. Quiz Answer Checking Tool (index.ts)
- Create `validate_quiz_answers` MCP tool to:
  - Accept quiz ID/title, user answers array, lesson data
  - Compare user answers against answer key
  - Calculate score (correct_count / total_questions)
  - Determine pass/fail (>= 80%)
  - Return detailed feedback (which questions wrong, explanations)

### 3. Concept Retention Metrics (profile.ts)
- Extend PlayerProfile with:
  - `conceptRetention: Record<concept_id, RetentionMetrics>`
  - `RetentionMetrics` includes:
    - `quizAttempts: number` - total quiz attempts for this concept
    - `quizzesPassed: number` - how many passed (>= 80%)
    - `passRate: number` - percentage of attempts that passed
    - `lastAttemptDate: string` - ISO timestamp of last quiz
    - `attemptHistory: QuizAttempt[]` - array of attempts with scores

### 4. Retention Metrics Tool (index.ts)
- Create `get_concept_retention` MCP tool to:
  - Analyze concept mastery across all lessons
  - Identify weak concepts (pass rate < 60%)
  - Show concept trends over time
  - Recommend concepts for review
  - Display retention statistics by concept category

## Acceptance Criteria

- [x] `validateQuiz()` function in lessons.ts validates quiz structure completely
- [x] Quiz validation catches all structural errors (missing answers, too many options, etc.)
- [x] `validate_quiz_answers` MCP tool implemented and works correctly
- [x] `validate_quiz_answers` properly scores quizzes and determines pass/fail
- [x] `validate_quiz_answers` returns helpful feedback for failed questions
- [x] PlayerProfile extended with `conceptRetention` tracking
- [x] `recordQuizAttempt()` function in profile.ts records quiz results
- [x] `get_concept_retention` MCP tool displays all retention metrics
- [x] `get_concept_retention` identifies weak concepts (pass rate < 60%)
- [x] `get_concept_retention` shows historical trends
- [x] All new functions have comprehensive unit tests
- [x] Code follows TypeScript style conventions
- [x] Code passes clippy/eslint linting
- [x] All tests pass with `npm test`
- [x] Git status is clean after all changes